<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>è´­ç‰©ç«¯</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" href="./static_resources/element-plus-index.css" />
    <link rel="stylesheet" href="./static_resources/vxe-table-style.css">
    <script src="./static_resources/vue.global.js"></script>
    <script src="./static_resources/element-plus-index.full.js"></script>
    <script src="./static_resources/xe-utils.js"></script>
    <script src="./static_resources/vxe-table@4.6.25.js"></script>
    <script src="./static_resources/axios.min.js"></script>
    <script src="./static_resources/element-plus_icons-vue.js"></script>
    <link rel="apple-touch-icon" sizes="180x180" href="./favicon_logosc/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./favicon_logosc/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./favicon_logosc/favicon-16x16.png">
    <link rel="manifest" href="./favicon_logosc/site.webmanifest">
    <link rel="stylesheet" href="./static_resources/app-css.css">

</head>
<body>
<div id="app">
    <div class="topbar">
        <div class="container" style="display: flex; justify-content: space-between; align-items: center;">
            <div class="top-left">
                <span class="welcome">ç¾é£Ÿåœ°å›¾æ¬¢è¿ä½ </span>

                <span v-if="!isLogined"><span class="login">è¯·<a href="#" @click="loginTo">ç™»å½•</a></span><span class="register"><a href="#" @click="resgiterTo">æ³¨å†Œ</a></span></span>

                <input type="button" @click="ceshi" value="æµ‹è¯•" >
            </div>
            <div class="top-right">
                <el-popover
                        :offset="45"
                        v-if="isLogined"
                >
                    <template #reference>
                        <div class="userAvatar">
                            <el-avatar :size="30" :src="`../img/é»˜è®¤å¤´åƒ.png`"></el-avatar>
                        </div>
                    </template>
                    <h3 v-if="this.loginedUSerData.name" style="text-align: center;">{{this.loginedUSerData.name}}</h3>
                    <div class="user-avatar-detail-item">

                        <ul>
                            <li><div class="item" @click="toUserDetailPage"><h3 >ä¸ªäººä¸­å¿ƒ</h3><span>></span></div></li>
                            <li><div class="item" @click="toUserShoppingCart"><h3 >è´­ç‰©è½¦</h3><span>></span></div></li>
                            <li><div class="item" @click="toUserOrder"><h3 >æˆ‘çš„è®¢å•</h3><span>></span></div></li>
                            <li><div class="item" @click="toSetting"><h3 >è®¾ç½®</h3><span>></span></div></li>
                        </ul>
                        <el-button type="danger" plain style="width: 100%;" @click="outLogin">é€€å‡ºç™»å½•</el-button>
                    </div>
                </el-popover>

                <ul class="top-nav" v-if="isLogined">
                    <li><a href="http://localhost:8080/userDetail.html?itemNumber=3">æˆ‘çš„è®¢å•</a></li>
                    <li><a href="http://localhost:8080/userDetail.html?itemNumber=2">è´­ç‰©è½¦</a></li>
                    <li><a href="http://localhost:8080/userDetail.html?itemNumber=1">æˆ‘çš„</a></li>
                    <li><a href="#">ç¾é£Ÿåœ°å›¾ä¼šå‘˜</a></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="header">
        <div class="container" style="display: flex; justify-content: space-between;">
            <div class="logo-frame">
                <img src="./favicon_logosc/android-chrome-512x512.png" alt="ç¾é£Ÿåœ°å›¾" width="100px" height="100px">
            </div>
            <div class="search-frame">
                <form action="#" >
                    <input type="text" placeholder="è¯·è¾“å…¥å•†å“åç§°" v-model="searchQuery">
                    <button type="submit" title="æœç´¢" @click="getGoodsList"></button>
                </form>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="line">
        </div>
    </div>
    <div class="banner">
        <div class="container">
            <el-carousel :interval="4000" type="card" height="200px">
                <el-carousel-item v-for="logoId in banner" :key="logoId">
                    <h3 text="2xl" justify="center">{{ logoId }}</h3>
                    <!-- <img title="banner-logo" v-if="logoId" :src="`http://localhost:8080/MFile/download?id=${logoId}`" width="100%" height="200px" /> -->
                </el-carousel-item>
            </el-carousel>
        </div>
    </div>
    <div class="main-content">
        <div class="container">
            <div class="merchantDetailPage" v-if="isOnMerchantPage!=false">
                <div class="merchant-compent" >
                    <el-avatar shape="square" :size="50" v-if="merchantInfo.logoUrl" :src="`http://localhost:8080/MFile/download?id=${merchantInfo.logoUrl}`"/></el-avatar>
                    <el-avatar shape="square" :size="50" v-else >merchant</el-avatar>
                    <button type="button" class="merchant-name" >{{merchantInfo.merchantName}}</button>
                    <el-button class="backShopping" type="text" @click="isOnMerchantPage=false; getGoodsList()">è¿”å›å•†åŸ</el-button>
                </div>
                <div class="line"></div>
                <div class="goods" style="display: flex; flex-wrap: wrap;justify-content: space-around;">
                    <el-card style="width: 230px; margin:0 25px; margin-bottom: 20px;"
                             v-for="item in lists"
                             :key="item.spuName"
                             :body-style="{ padding: '0px', marginBottom: '1px' }"
                    >
                        <!-- <img title="å•†å“å›¾ç‰‡"
                          :src="`http://localhost:8080/MFile/download?id=${item.mainImage}`"
                          class="image multi-content"
                          style="max-width: 100%"
                        /> -->
                        <div style="height: 200px;display:flex;align-items: center;justify-content: center;">{{item.mainImage}}</div>

                        <div style="padding: 14px">
                            <span>{{ item.spuName }}</span>
                            <div class="bottom card-header">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div class="detail">{{ item.spuDesc }}</div>
                                    <el-button text class="button" @click="onCheckGoodsDetail(item)">></el-button>
                                </div>
                            </div>
                        </div>
                    </el-card>
                </div >
                <div class="pagination-block" style="display: flex; justify-content: center;">
                    <el-pagination
                            v-model:current-page="page.currentPage"
                            v-model:page-size="page.pageSize"
                            :page-sizes="[8, 16, 32, 64]"
                            layout="sizes, prev, pager, next"
                            :total="page.total"
                            @current-change="onPageChangeOnMerchant"
                            @size-change="onSizeChangeOnMerchant"
                    />
                </div>
                <div class="line two"></div>
            </div>
            <div class="shopping-main" v-else>
                <div class="title" >å•†åŸ</div>
                <div class="line"></div>
                <div class="goods" style="display: flex; flex-wrap: wrap;justify-content: space-around;">
                    <el-card style="width: 230px; margin:0 25px; margin-bottom: 20px;"
                             v-for="item in lists"
                             :key="item.spuName"
                             :body-style="{ padding: '0px', marginBottom: '1px' }"
                    >
                        <!-- <img title="å•†å“å›¾ç‰‡"
                          :src="`http://localhost:8080/MFile/download?id=${item.mainImage}`"
                          class="image multi-content"
                          style="max-width: 100% ;"
                          height="200px"
                        /> -->
                        <div style="height: 200px;display:flex;align-items: center;justify-content: center;">{{item.mainImage}}</div>

                        <div style="padding: 14px">
                            <span>{{ item.spuName }}</span>
                            <div class="bottom card-header">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div class="detail">{{ item.spuDesc }}</div>
                                    <el-button text class="button" @click="onCheckGoodsDetail(item)">></el-button>
                                </div>
                            </div>
                        </div>
                    </el-card>
                </div >
                <div class="pagination-block" style="display: flex; justify-content: center;">
                    <el-pagination
                            v-model:current-page="page.currentPage"
                            v-model:page-size="page.pageSize"
                            :page-sizes="[8, 16, 32, 64]"
                            layout="sizes, prev, pager, next"
                            :total="page.total"
                            @current-change="onPageChange"
                            @size-change="onSizeChange"
                    />
                </div>
                <div class="line two"></div>
            </div>
        </div>
        <el-drawer
                v-model="drawer"
                title="å•†å“è¯¦æƒ…"
                :direction="direction"
                :before-close="handleClose"
        >
            <div class="merchant-compent" >
                <el-avatar shape="square" :size="50" v-if="merchantInfo.logoUrl" :src="`http://localhost:8080/MFile/download?id=${merchantInfo.logoUrl}`"/></el-avatar>
                <el-avatar shape="square" :size="50" v-else >merchant</el-avatar>
                <button type="button" title="è¿›å…¥å•†é“º" class="merchant-name"   @click="onMerchantDetail">{{merchantInfo.merchantName}}</button>
            </div>
            <div class="buy-main">
                <el-carousel trigger="click" height="300px">
                    <el-carousel-item v-for="url in skuImageUrls" :key="url">
                        <h3 text="2xl" justify="center">{{ url }}</h3>
                        <!-- <img title="goods-detail-img" v-if="url" :src="`http://localhost:8080/MFile/download?id=${url}`" width="100%" height="300px" /> -->
                    </el-carousel-item>
                </el-carousel>
                <h3 class="goods-name">{{onCkeckGoodsDetailId.spuName}}</h3>
                <h4>{{onCkeckGoodsDetailId.spuDesc}}</h4>
                <span class="selected-spec">
                    å·²é€‰æ‹©{{selectedSpecs}}
<!--                    {{selectedSpecsPrice}}-->
                </span>
                <ul v-for="(skuValue, skuKey) in skuObj">
                    <li>{{skuKey}}</li>
                    <el-checkbox-group v-model="selectedSpecs" size="large"  :max="3">
                        <el-checkbox-button v-for=" vv in skuValue" :key="vv" :label="vv" >
                            {{ vv }}
                        </el-checkbox-button>
                    </el-checkbox-group>
                </ul>
                <div style="display: flex;align-items: center;margin-top: 25px;">
                    æ€»ä»·: Â¥
                    <div v-if="totalPrice > 0" class="price-display">
                        {{ totalPrice }}
                    </div>
                </div>

                <div style="display: flex;justify-content: space-between;margin-top: 210px; margin-bottom: 25px;">
                    <h2>è´­ä¹°æ•°é‡</h2>
                    <el-input-number v-model="bugNumber" :min="1" label="è´­ä¹°æ•°é‡"></el-input-number>
                </div>
                <div style="display: flex;justify-content: space-between;">
                    <el-button type="primary" plain @click="addShoppingCart">åŠ å…¥è´­ç‰©è½¦</el-button>
                    <el-button type="danger" plain  @click="directBuy">ç«‹å³è´­ä¹°</el-button>
                </div>
            </div>
        </el-drawer>
    </div>
    <div class="floor">
        <div class="container">
            <!-- é¡¶éƒ¨é“¾æ¥ -->
            <div class="top-links clearfix">
                <ul class="links-list">
                    <li><a href="#">è´­ç‰©æŒ‡å—</a></li>
                    <li><a href="#">è´­ç‰©æµç¨‹</a></li>
                    <li><a href="#">ä¼šå‘˜ä»‹ç»</a></li>
                    <li><a href="#">ç¾é£Ÿæ—…è¡Œ</a></li>
                    <li><a href="#">å¸¸è§é—®é¢˜</a></li>
                    <li><a href="#">è”ç³»å®¢æœ</a></li>
                </ul>
                <ul class="links-list">
                    <li><a href="#">é…é€æ–¹å¼</a></li>
                    <li><a href="#">ä¸Šé—¨è‡ªæ</a></li>
                    <li><a href="#">ç§’é€</a></li>
                    <li><a href="#">é…é€æœåŠ¡æŸ¥è¯¢</a></li>
                    <li><a href="#">é…é€è´¹æ”¶å–æ ‡å‡†</a></li>
                </ul>
                <ul class="links-list">
                    <li><a href="#">æ”¯ä»˜æ–¹å¼</a></li>
                    <li><a href="#">è´§åˆ°ä»˜æ¬¾</a></li>
                    <li><a href="#">åœ¨çº¿æ”¯ä»˜</a></li>
                    <li><a href="#">ç”Ÿæ´»æ—…è¡Œ</a></li>
                    <li><a href="#">åˆ†æœŸä»˜æ¬¾</a></li>
                    <li><a href="#">å…¬å¸è½¬è´¦</a></li>
                </ul>
                <ul class="links-list">
                    <li><a href="#">å”®åæœåŠ¡</a></li>
                    <li><a href="#">å”®åæ”¿ç­–</a></li>
                    <li><a href="#">ä»·æ ¼ä¿æŠ¤</a></li>
                    <li><a href="#">é€€æ¬¾è¯´æ˜</a></li>
                    <li><a href="#">è¿”ä¿®/é€€æ¢è´§</a></li>
                    <li><a href="#">å–æ¶ˆè®¢å•</a></li>
                </ul>
                <ul class="links-list">
                    <li><a href="#">ç‰¹è‰²æœåŠ¡</a></li>
                    <li><a href="#">ç‰¹è‰²æœåŠ¡</a></li>
                    <li><a href="#">ç‰¹è‰²æœåŠ¡</a></li>
                    <li><a href="#">å»¶ä¿æœåŠ¡</a></li>
                    <li><a href="#">ç¾é£Ÿåœ°å›¾Eå¡</a></li>
                    <li><a href="#">ç¾é£Ÿåœ°å›¾é€šä¿¡</a></li>
                </ul>
                <ul class="links-list">
                    <li><a href="#">è‡ªè¥è¦†ç›–åŒºå¿</a></li>
                    <li><a href="#">ç¾é£Ÿåœ°å›¾å·²å‘å…¨å›½2661ä¸ªåŒºå¿</a></li>
                    <li><a href="#">æä¾›è‡ªè¥é…é€æœåŠ¡ï¼Œæ”¯æŒè´§åˆ°</a></li>
                    <li><a href="#">ä»˜æ¬¾ã€POS æœºåˆ·å¡å’Œå”®åä¸Šé—¨</a></li>
                    <li><a href="#">å¸¸è§é—®é¢˜</a></li>
                    <li><a href="#">æŸ¥çœ‹è¯¦æƒ…</a></li>
                </ul>
            </div>
            <div class="line"></div>
            <div class="bottom-links">
                <ul class="bottom-links-list clearfix">
                    <li><a href="#">å…³äºæˆ‘ä»¬</a></li>
                    <li><a href="#">è”ç³»æˆ‘ä»¬</a></li>
                    <li><a href="#">è”ç³»å®¢æœ</a></li>
                    <li><a href="#">åˆä½œæ‹›å•†</a></li>
                    <li><a href="#">å•†å®¶å¸®åŠ©</a></li>
                    <li><a href="#">è¥é”€ä¸­å¿ƒ</a></li>
                    <li><a href="#">æ‰‹æœºå°šå“</a></li>
                    <li><a href="#">å‹æƒ…é“¾æ¥</a></li>
                    <li><a href="#">é”€å”®è”ç›Ÿ</a></li>
                    <li><a href="#">éšç§æ”¿ç­–</a></li>
                </ul>
                <div class="copyright">äº¬ICPå¤‡1145141919810</div>
                <div class="copyright">é™ˆå¿—è±ª&nbsp;&nbsp;&nbsp;ç”°æ¢“éœ–&nbsp;&nbsp;&nbsp;ç‹è¯—ç‚€&nbsp;&nbsp;&nbsp;éƒ‘æ–‡å˜‰<sup>è‘—</sup></div>
            </div>
        </div>
    </div>
    <el-dialog
            v-model="loginDialogVisible"
            title="å¿«æ·ç™»å½•"
            width="500"
            :before-close="loginHandleClose"
    >
        <div class="login-resgister-btn">
            <el-button type="text"  @click="isLogin = true">ğŸ˜„ç™»å½•</el-button>
            <el-button type="text" @click="isLogin = false">ğŸ¤—æ³¨å†Œ</el-button>
        </div>
        <div v-if="isLogin">
            <el-form ref="loginedUSerData"
                    style="max-width: 600px"
                    :model="loginFormData"
                    status-icon
                    :rules="rules"
                    label-width="auto"
            >
                <el-form-item label="ç™»é™†è´¦å·" prop="code">
                    <el-input v-model="loginFormData.code" type="text" placeholder="è¯·è¾“å…¥æ‰‹æœºå·æˆ–é‚®ç®±"  autocomplete="off" />
                </el-form-item>
                <el-form-item label="å¯†ç " prop="password">
                    <el-input
                            placeholder="è¯·è¾“å…¥å¯†ç "
                            v-model="loginFormData.password"
                            type="password"
                            autocomplete="off"></el-input>
                </el-form-item>
            </el-form>
        </div>
        <div v-else>
            <el-form ref="loginedUSerData"
                    style="max-width: 600px"
                    :model="loginFormData"
                    status-icon
                    :rules="passwordRules"
                    label-width="auto"
            >
                <el-form-item label="ç™»é™†è´¦å·" prop="code">
                    <el-input v-model="loginFormData.code" type="text" autocomplete="off"  placeholder="è¯·è¾“å…¥æ‰‹æœºå·æˆ–é‚®ç®±"/>
                </el-form-item>
                <el-form-item label="å¯†ç " prop="password">
                    <el-input
                            placeholder="è¯·è¾“å…¥å¯†ç "
                            v-model="loginFormData.password"
                            type="password"
                            autocomplete="off"
                    />
                </el-form-item>
                <el-form-item label="ç¡®è®¤å¯†ç " prop="confirmPassword">
                    <el-input
                            placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç "
                            v-model="loginFormData.confirmPassword"
                            type="password"
                            autocomplete="off"
                    />
                </el-form-item>

            </el-form>
        </div>
        <template #footer>
            <div class="dialog-footer">
                <el-button @click="dislabeloginDialog" >å–æ¶ˆ</el-button>
                <el-button type="primary" @click="isLogin ? confirmLogin() : registerUser()">
                    ç¡®å®š
                </el-button>
            </div>
        </template>
    </el-dialog>
</div>
</body>
<script setup>
    axios.defaults.withCredentials = true;
    const app =  Vue.createApp({
        data(){
            return{
                isLogined:false,
                loginedUSerData:{
                    id:'',
                    code:'',
                    name:'',
                    gender:'',
                    avatar:'',
                    city:'',
                    levelId:'',
                    createTime:'',
                },
                isUserAvatarDetail:false,
                isLogin:true,
                loginFormData: {
                    code: '',
                    password: '',
                    confirmPassword:'',
                },
                rules: {
                    code: [
                        { required: true, message: 'è¯·è¾“å…¥ç™»å½•è´¦å·', trigger: 'blur' }
                    ],
                    password: [
                        { required: true, message: 'è¯·è¾“å…¥ç™»å½•å¯†ç ', trigger: 'blur' }
                    ]
                },
                passwordRules: {
                    code: [
                        { required: true, message: 'è¯·è¾“å…¥ç™»å½•è´¦å·', trigger: 'blur' },
                        {
                            validator(rule, value, callback) {
                                if (value) {
                                    if (/^(?:0|86|\+86)?1[3-9]\d{9}$/.test(value) || /(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)])/.test(value)) {
                                        callback();
                                    } else {
                                        callback(new Error('é‚®ç®±æˆ–æ‰‹æœºæ ¼å¼é”™è¯¯'))
                                    }
                                } else {
                                    callback();
                                }
                            }, trigger: 'blur'
                        }
                    ],
                    password: [{required: true, message: 'è¯·è¾“å…¥å¯†ç '},
                        {
                            validator(rule, value, callback) {
                                if (value) {
                                    if (/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z\W]{6,18}$/.test(value)) {
                                        callback();
                                    } else {
                                        callback(new Error('è¯·è¾“å…¥åŒ…å«è‹±æ–‡å’Œæ•°å­—ï¼Œåœ¨6-18ä½ä¹‹é—´'))
                                    }
                                } else {
                                    callback();
                                }
                            },
                            trigger: 'blur'
                        }
                    ],
                    confirmPassword: [
                        { required: true, message: 'è¯·å†æ¬¡è¾“å…¥å¯†ç ', trigger: 'blur' }
                    ]
                },
                loginDialogVisible:false,
                isOnMerchantPage:false,
                searchQuery:'',
                banner: [],
                bugNumber:1,
                direction:'rtl',
                drawer:false,
                page: {
                    currentPage:1,
                    pageSize:8,
                    total:0,
                },
                onCkeckGoodsDetailId:{},
                merchantInfo:{
                    merchantId:'',
                    merchantName:'',
                    logoUrl:'',
                },
                lists: [],
                skus: [],
                skuKeys: [],
                selectedSpecs: [],
                selectedSpecsPrice: new Map(),
                skuImageUrls: [],
            }
        },
        async created(){
            // this.handleSku();
            await this.getGoodsList();
            await this.getBanner();
            this.autoLogin();
        },
        methods:{
            autoLogin(){
                axios.post('/user/autoLogin')
                    .then(response => {
                        if (response.status === 200) {
                            if (response.data.id !== null) {
                                this.$message({
                                    message:'è‡ªåŠ¨ç™»å½•æˆåŠŸ',
                                    type: 'success'
                                })
                                this.loginedUSerData =  response.data;
                                this.isLogined = true;
                            }
                        }
                    }).catch(error => {

                })
            },
            addShoppingCart(){
                const toSendData = Object.fromEntries(this.selectedSpecsPrice);
                if (this.loginedUSerData.id !== '') {
                    axios.post('http://localhost:8080/shoppingCart/addShoppingCart', {
                        userId: this.loginedUSerData.id,
                        spuId:this.onCkeckGoodsDetailId.spuId ,
                        merchantId: this.merchantInfo.merchantId,
                        quantity: this.bugNumber,
                        specs:this.selectedSpecs,
                        unitPrice: this.calculateUnitPrice(),
                        totalPrice:this.totalPrice,
                    }).then(res => {
                        if (res.status === 200) {
                            this.$message({
                                message:'æ·»åŠ æˆåŠŸ',
                                type: 'success'
                            })
                            this.clearData();
                            this.drawer = false;
                        }else {
                            this.$message({
                                message:'æ·»åŠ å¤±è´¥',
                                type: 'error'
                            })
                        }
                    }).catch(err => {
                        this.$message({
                            message:'å¼‚å¸¸'+err.message,
                            type: 'error'
                        })
                    })
                }else {
                    this.$message({
                        message:'è¯·å…ˆç™»å½•',
                        type: 'warning'
                    })
                }
            },
            toUserDetailPage(){
                if(!this.isLogined){
                    this.$message({
                        message: 'è¯·å…ˆç™»å½•',
                        type: 'warning'
                    });
                    return;
                }else{
                    window.location.href = `http://localhost:8080/userDetail.html?itemNumber=1`;
                    // window.open('http://localhost:8080/userDetail','_blank');
                }
            },
            toUserShoppingCart(){
                if(!this.isLogined){
                    this.$message({
                        message: 'è¯·å…ˆç™»å½•',
                        type: 'warning'
                    });
                    return;
                }else{
                    window.location.href = `http://localhost:8080/userDetail.html?itemNumber=2`;

                }
            },
            toUserOrder(){
                if(!this.isLogined){
                    this.$message({
                        message: 'è¯·å…ˆç™»å½•',
                        type: 'warning'
                    });
                    return;
                }else{
                    window.location.href = `http://localhost:8080/userDetail.html?itemNumber=3`;

                }
            },
            toSetting(){
                if(!this.isLogined){
                    this.$message({
                        message: 'è¯·å…ˆç™»å½•',
                        type: 'warning'
                    });
                    return;
                }else{
                    window.location.href = `http://localhost:8080/userDetail.html?itemNumber=4`;

                }
            },
            ceshi(){
                axios.post('http://localhost:8080/test/hello').then(response => {
                    if (response.status === 200) {
                        this.$message({
                            message: response.data,
                            type: 'success'
                        });
                        console.log(response.data);
                    } else {
                        this.$message({
                            message: response.data,
                            type: 'warning'
                        });
                        console.error('è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç ï¼š', response.status);
                    }
                }).catch(error => {
                    this.$message({
                        message: 'æµ‹è¯•å¤±è´¥',
                        type: 'warning'
                    });
                    console.error('è¯·æ±‚å‡ºé”™ï¼š', error);
                });
            },
            outLogin(){
                this.isLogined = false;
                this.loginedUSerData = {
                    id:'',
                    code:'',
                    name:'',
                    gender:'',
                    avatar:'',
                    city:'',
                    levelId:'',
                }
            },
            loginTo(){
                this.loginDialogVisible = true;
                this.isLogin = true;
            },
            resgiterTo(){
                this.loginDialogVisible = true;
                this.isLogin = false;
            },
            dislabeloginDialog(){
                this.loginDialogVisible = false;
                this.loginFormData = {
                    code: '',
                    password: '',
                    confirmPassword:'',
                };

            },
            confirmLogin(){
                if (!this.loginFormData.code || !this.loginFormData.password) {
                    this.$message({
                        message: 'è¯·è¾“å…¥è´¦å·å’Œå¯†ç ',
                        type: 'warning'
                    });
                    return;
                }else{
                    console.log(this.loginFormData);
                    axios.post('http://localhost:8080/user/login',{
                        code:this.loginFormData.code,
                        password:this.loginFormData.password,
                    }).then(response => {
                        if (response.status === 200) {
                            this.$message({
                                message: 'ç™»å½•æˆåŠŸ',
                                type: 'success'
                            });
                            this.loginedUSerData =  response.data;
                            this.isLogined = true;
                            this.dislabeloginDialog();
                        } else {
                            this.$message({
                                message: 'ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥è´¦å·å¯†ç ',
                                type: 'warning'
                            });
                            console.error('è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç ï¼š', response.status);
                        }
                    }).catch(error => {
                        this.$message({
                            message: 'ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥è´¦å·å¯†ç ',
                            type: 'warning'
                        });
                        console.error('è¯·æ±‚å‡ºé”™ï¼š', error);
                    });
                }
            },
            registerUser(){
                if (!this.loginFormData.code || !this.loginFormData.password || !this.loginFormData.confirmPassword) {
                    this.$message({
                        message: 'è¯·è¾“å…¥è´¦å·å’Œå¯†ç ',
                        type: 'warning'
                    });
                    return;
                }else{
                    if (this.loginFormData.password !== this.loginFormData.confirmPassword) {
                        this.$message({
                            message: 'ä¸¤æ¬¡è¾“å…¥å¯†ç ä¸ä¸€è‡´',
                            type: 'warning'
                        });
                        return;
                    }else{
                        console.log(this.loginFormData);
                        axios.post('http://localhost:8080/user/register',{
                            code:this.loginFormData.code,
                            password:this.loginFormData.password,
                        }).then(response => {
                            if (response.status === 200) {
                                this.$message({
                                    message: 'æ³¨å†ŒæˆåŠŸï¼Œè¯·ç™»å½•',
                                    type: 'success'
                                });
                                this.isLogin = true;
                            } else {
                                this.$message({
                                    message: 'æ³¨å†Œå¤±è´¥ï¼Œè¯·æ£€æŸ¥è´¦å·æ˜¯å¦å·²è¢«æ³¨å†Œ',
                                    type: 'warning'
                                });
                                console.error('è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç ï¼š', response.status);
                            }
                        }).catch(error => {
                            this.$message({
                                message: 'æ³¨å†Œå¤±è´¥ï¼Œè¯·æ£€æŸ¥è´¦å·æ˜¯å¦å·²è¢«æ³¨å†Œ',
                                type: 'warning'
                            });
                            console.error('è¯·æ±‚å‡ºé”™ï¼š', error);
                        });
                    };
                };


            },
            getMerchantInfo(merchantId){
                // æ ¹æ®å•†æˆ·idè·å–å•†æˆ·ä¿¡æ¯
                axios.post('http://localhost:8080/merchant/getMerchantById',{
                    merchantId:merchantId,
                }).then(response => {
                    if (response.status === 200) {
                        this.merchantInfo = response.data;
                    } else {
                        console.error('è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç ï¼š', response.status);
                    }
                }).catch(error => {
                    console.error('è¯·æ±‚å‡ºé”™ï¼š', error);
                });
            },
            async getGoodsList(){
                try {
                    const response = await axios.post('http://localhost:8080/MGoods/getGoodsList',{
                        searchQuery:this.searchQuery,
                        currentPage:this.page.currentPage,
                        pageSize:this.page.pageSize,
                    });
                    if (response.status === 200) {
                        this.lists = response.data.records;
                        this.page.currentPage = response.data.current;
                        this.page.pageSize = response.data.size;
                        this.page.total = response.data.total;
                    } else {
                        console.error('è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç ï¼š', response.status);
                    }
                } catch (error) {
                    console.error('è¯·æ±‚å‡ºé”™ï¼š', error);
                }
            },
            onMerchantDetail(){
                this.clearData();
                // è·³è½¬åˆ°å•†æˆ·çš„å•†å“åˆ—è¡¨é¡µ
                this.drawer = false;
                this.isOnMerchantPage = true;
                this.lists = [];
                axios.post('http://localhost:8080/MGoods/getMerchantsGoodsById',{
                    merchantId:this.merchantInfo.merchantId,
                    currentPage:this.page.currentPage,
                    pageSize:this.page.pageSize,
                }).then(response => {
                    if (response.status === 200) {
                        this.lists = response.data.records;
                        this.page.currentPage = response.data.current;
                        this.page.pageSize = response.data.size;
                        this.page.total = response.data.total;
                    } else {
                        console.error('è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç ï¼š', response.status);
                    }
                }).catch(error => {
                    console.error('è¯·æ±‚å‡ºé”™ï¼š', error);
                });
            },
            async getBanner(){

                try {
                    const response = await axios.post('http://localhost:8080/MGoods/getBanner');
                    if (response.status === 200) {
                        this.banner = response.data;
                    } else {
                        console.error('è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç ï¼š', response.status);
                    }
                } catch (error) {
                    console.error('è¯·æ±‚å‡ºé”™ï¼š', error);
                }
            },
            onPageChange(){
                this.getGoodsList();
                console.log(this.page.currentPage)
            },
            onSizeChange(){
                this.getGoodsList();
                console.log(this.page.pageSize)
            },
            onPageChangeOnMerchant(){
                this.onMerchantDetail();
                console.log(this.page.currentPage)
            },
            onSizeChangeOnMerchant(){
                this.onMerchantDetail();
                console.log(this.page.pageSize)
            },
            loginHandleClose(done) {
                this.$confirm('ğŸ¤”ç¡®å®è¦å…³é—­ç™»å½•å—ï¼Ÿ', 'è­¦å‘Š', {
                    confirmButtonText: 'ç¡®å®š',
                    cancelButtonText: 'å–æ¶ˆ',
                    type: 'warning'
                }).then(() => {
                    // ç‚¹å‡»å–æ¶ˆæˆ–å…³é—­
                    done()
                }).catch(() => {
                    //é”™è¯¯å¤„ç†
                })
            },
            handleClose(done) {
                this.$confirm('ç¡®å®è¦æ”¾å¼ƒè´­ä¹°å—ï¼Ÿ', 'è­¦å‘Š', {
                    confirmButtonText: 'ç¡®å®š',
                    cancelButtonText: 'å–æ¶ˆ',
                    type: 'warning'
                }).then(() => {
                    // ç‚¹å‡»å–æ¶ˆæˆ–å…³é—­
                    done()
                    this.clearData();
                }).catch(() => {
                    //é”™è¯¯å¤„ç†
                })
            },
            clearData(){
                this.bugNumber = 1;
                this.selectedSpecs = [];
                this.onCkeckGoodsDetailId = {};
                this.skus = [];
                this.skuKeys = [];
                this.skuImageUrls = [];
                this.selectedSpecsPrice  = new Map();
            },
            onCheckGoodsDetail(item){
                console.log(item);
                this.clearData();
                // æ ¹æ®idè·å–å•†å“è¯¦æƒ…

                this.onCkeckGoodsDetailId = item;
                this.drawer = true;
                axios.post('http://localhost:8080/MGoods/getSkuBySpuId',{
                        spuId:item.spuId
                    }
                ).then(response => {
                    if (response.status === 200) {
                        this.skus = response.data.records;
                        // æ ¹åŸºæ®å•†æˆ·idè·å–å•†æˆ·ä¿¡æ¯
                        this.getMerchantInfo(item.merchantId);
                        this.handleSku();
                        this.handleImageUrls();

                    } else {
                        console.error('è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç ï¼š', response.status);
                    }
                }).catch(error => {
                    console.error('è¯·æ±‚å‡ºé”™ï¼š', error);
                });
            },
            handleSku(){
                this.skus.forEach(item => {
                    // const obj = JSON.parse(item.elementSpecs);
                    const obj = item.elementSpecs;
                    for (let key in obj) {
                        if (this.skuKeys.indexOf(key)  == -1){
                            this.skuKeys.push(key);
                        }
                    }
                });
            },
            handleImageUrls(){
                this.skus.forEach(item => {
                    const urls = item.imageUrl;
                    urls.forEach(url => {
                        if (this.skuImageUrls.indexOf(url) == -1){
                            this.skuImageUrls.push(url);
                        }
                    });
                });
            },
            findPriceBySpecs(specValue){
                for(let sku of this.skus){
                    // const priceObj = JSON.parse(sku.specsPrice);
                    const priceObj = sku.specsPrice;
                    if(priceObj.hasOwnProperty(specValue)){
                        return parseFloat(priceObj[specValue]) || 0;
                    }
                }
            },
            directBuy(){
                if(this.loginedUSerData.id === ''){
                    this.$message({
                        message: 'è¯·å…ˆç™»å½•',
                        type: 'warning'
                    });
                    return false;
                }
                let utilPrice = this.calculateUnitPrice();
                axios.post('http://localhost:8080/order/directBuy',{
                    userId:this.loginedUSerData.id,
                    spuId:this.onCkeckGoodsDetailId.spuId,
                    merchantId:this.merchantInfo.merchantId,
                    specs:this.selectedSpecs,
                    unitPrice:utilPrice.toFixed(2),
                    quantity:this.bugNumber,
                    totalPrice:this.totalPrice.toFixed(2),
                }).then(response => {
                    if (response.status === 200) {
                        this.$message({
                            message:'è´­ä¹°æˆåŠŸ',
                            type: 'success'
                        })
                        this.drawer = false;
                        this.clearData();
                    }
                }).catch(error => {
                        this.$message({
                            message:error.message,
                            type:'error'
                        })
                })
            },
            calculateUnitPrice(){
                let unitPrice = 0;
                this.selectedSpecsPrice = new Map();
                this.selectedSpecs.forEach(specValue => {
                    this.selectedSpecsPrice.set(specValue,this.findPriceBySpecs(specValue));
                    unitPrice += this.findPriceBySpecs(specValue);
                });
                return unitPrice;
            }
        },
        watch: {
            'isLogin':function(newValue,OldValue){
                this.loginFormData = {
                    code: '',
                    password: '',
                    confirmPassword:'',
                };
            }
        },
        computed: {
            skuObj(){
                let skuObj = {};
                this.skuKeys.forEach(item => {
                    skuObj[item] = [];
                })
                this.skus.forEach(item => {
                    // const obj = JSON.parse(item.elementSpecs);
                    const obj = item.elementSpecs;
                    this.skuKeys.forEach(item => {
                        if (skuObj[item].indexOf(obj[item]) == -1){
                            skuObj[item].push(obj[item]);
                        }
                    })
                });
                return skuObj;
            },
            totalPrice() {
                let total = 0;
                this.selectedSpecsPrice = new Map();
                this.selectedSpecs.forEach(specValue => {
                    this.selectedSpecsPrice.set(specValue,this.findPriceBySpecs(specValue));
                    total += this.findPriceBySpecs(specValue);
                });
                total = total * this.bugNumber;
                return total;
            }
        },

    });
    for(const[key, component] of Object.entries(ElementPlusIconsVue)) {app.component(key, component)}
    app.use(ElementPlus).use(VxeUITable).mount('#app');
</script>
</html>