<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ÂïÜÂìÅÁÆ°ÁêÜ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" href="/static_resources/element-plus-index.css" />
    <link rel="stylesheet" href="/static_resources/vxe-table-style.css">
    <script src="/static_resources/vue.global.js"></script>
    <script src="/static_resources/element-plus-index.full.js"></script>
    <script src="/static_resources/xe-utils.js"></script>
    <script src="/static_resources/vxe-table@4.6.25.js"></script>
    <script src="/static_resources/axios.min.js"></script>
    <script src="/static_resources/element-plus_icons-vue.js"></script>
    <script src="/static_resources/zh-cn.js"></script>
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon_logosc/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon_logosc/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon_logosc/favicon-16x16.png">
    <link rel="manifest" href="/favicon_logosc/site.webmanifest">
</head>
<body>
<div id="app">
    <template v-if=!isDetail>
    <el-row>
        <el-form :inline="true" :model="form">
            <el-form-item label="ÂïÜÂìÅÁºñÂè∑"><el-input v-model="form.spuId" clearable /></el-form-item>

            <el-form-item label="ÂïÜÂìÅÂàÜÁ±ª">
                <el-select v-model="form.productCategory" placeholder="ËØ∑ÈÄâÊã©" style="width: 240px">
                    <el-option v-for="item in options1" :key="item.value" :label="item.label" :value="item.value"/>
                </el-select>
            </el-form-item>

            <el-form-item label="ÊâÄÂ±ûÂïÜÊà∑">
                <el-select v-model="form.merchantId" placeholder="ËØ∑ÈÄâÊã©" style="width: 240px">
                    <el-option v-for="item in options2" :key="item.value" :label="item.label" :value="item.value"/>
                </el-select>
            </el-form-item>

            <el-form-item> <el-button type="primary" @click="onSearch">Êü•ËØ¢</el-button> </el-form-item>

            <el-form-item> <el-button type="primary" @click="onDelete">ÈáçÁΩÆ</el-button> </el-form-item>
        </el-form>

        <el-form :inline="true" :model="form">
            <el-form-item label="ÂïÜÂìÅÂêçÁß∞"><el-input v-model="form.spuName" clearable /></el-form-item>
            <el-form-item label="ÂàõÂª∫Êó∂Èó¥"><el-date-picker v-model="form.createTime" type="date" placeholder="Pick a day" :size="form.size" value-format="YYYY-MM-DD" /></el-form-item>
            <el-form-item label="‰∏äÊû∂Áä∂ÊÄÅ">
                <el-select v-model="form.shelfStatus" placeholder="ËØ∑ÈÄâÊã©" style="width: 240px">
                    <el-option v-for="item in options3" :key="item.value" :label="item.label" :value="item.value"/>
                </el-select>
            </el-form-item>
            <el-form-item label="ÂÆ°ÊâπÁä∂ÊÄÅ">
                <el-select v-model="form.approvalStatus" placeholder="ËØ∑ÈÄâÊã©" style="width: 240px">
                    <el-option v-for="item in options4" :key="item.value" :label="item.label" :value="item.value"/>
                </el-select>
            </el-form-item>
        </el-form>
    </el-row>

    <!--    Ë°®Ê†º-->
    <el-row>
        <vxe-grid v-bind="gridOptions" style="width: 100%">

            <!--            Êü•ËØ¢ÊåâÈíÆÔºà1.Á±ªÂûã 2.ÁÇπÂáªÂêéËß¶ÂèëÊñπÊ≥ï 3.ÊåâÈíÆÊòæÁ§∫ÂÜÖÂÆπÔºâ-->
            <template #toolbar_buttons><el-button type="primary" @click="add">Êñ∞Â¢û</el-button>
            </template>


            <!--            Êìç‰Ωú-->
            <template #operate="{ row }">
                <el-button size="small" type="primary" @click="showDetailDialog(row)">Êü•Áúã</el-button>
                <el-button size="small" type="primary" @click="edit(row)">ÂÆ°Ê†∏</el-button>
                <el-button size="small" type="danger" @click="onRemove(row.merchantId)">Âà†Èô§</el-button>
            </template>

            <!--            Êç¢È°µ-->
            <template #pager>
                <vxe-pager :layouts="['Sizes', 'PrevPage', 'Number', 'NextPage', 'Total']" v-model:current-page="page.current" v-model:page-size="page.size" :total="page.total" @page-change="onPageChange">
                </vxe-pager>
            </template>
        </vxe-grid>

        <!--       ÂÆ°Ê†∏ÂíåÊñ∞Â¢ûÈ°µÈù¢-->
        <el-dialog v-model="showDialog" :title="isEdit ? 'ÂÆ°Ê†∏' : 'Êñ∞Â¢û'" width="600">
            <el-form ref="editForm" :model="editForm" :rules="rules" label-width="auto">

                <!--                ÂïÜÂìÅID-->
                <el-form-item v-if="isEdit" label="ÂïÜÂìÅID" prop="spuId">
                    <el-input v-model="editForm.spuId" :disabled="isEdit" maxlength="20" />
                </el-form-item>

                <!--                ÂïÜÂìÅÂêçÁß∞-->
                <el-form-item label="ÂïÜÂìÅÂêçÁß∞" prop="spuName">
                    <el-input v-model="editForm.spuName" maxlength="20" />
                </el-form-item>

                <!--                ÂïÜÂìÅÊèèËø∞-->
                <el-form-item label="ÂïÜÂìÅÊèèËø∞" prop="spuDesc">
                    <el-input v-model="editForm.spuDesc" maxlength="20" />
                </el-form-item>

                <!--                ÂïÜÂìÅÂàÜÁ±ª-->
                <el-form-item label="ÂïÜÂìÅÂàÜÁ±ª">
                    <el-select v-model="editForm.productCategory" placeholder="ËØ∑ÈÄâÊã©" style="width: 240px">
                        <el-option v-for="item in options1" :key="item.value" :label="item.label" :value="item.value"/>
                    </el-select>
                </el-form-item>

                <!--                ÂïÜÂìÅÈîÄÈáè-->
                <el-form-item label="ÂïÜÂìÅÈîÄÈáè" prop="sales">
                    <el-input v-model="editForm.sales" maxlength="20" />
                </el-form-item>

                <!--                ÊâÄÂ±ûÂïÜÊà∑-->
                <el-form-item label="ÊâÄÂ±ûÂïÜÊà∑">
                    <el-select v-model="editForm.merchantId" placeholder="ËØ∑ÈÄâÊã©" style="width: 240px">
                        <el-option v-for="item in options2" :key="item.value" :label="item.label" :value="item.value"/>
                    </el-select>
                </el-form-item>

                <!--                ‰∏ªÂõæ-->
                <el-form-item label="‰∏ªÂõæ" prop="mainImage">
                    <el-upload :show-MFile-list="false" :before-upload="uploadMainImage">
                        <img v-if="editForm.mainImage"  :src="`/MFile/download?id=${editForm.mainImage}`" style="width: 100px; height: 100px" />
                        <el-icon v-else><Plus /></el-icon>
                    </el-upload>
                </el-form-item>

                <!--                Â§öÂõæÁâá-->
                <el-form-item label="Â§öÂõæÁâá" prop="image">
                    <el-upload v-model:file-list="fileList"
                                list-type="picture-card"
                               :auto-upload="false"
                               multiple>
                        <i class="el-icon-plus"></i>
                    </el-upload>
                </el-form-item>
                <el-button @click="Submit(fileList)">Êèê‰∫§</el-button>

                <!--                ‰∏äÊû∂Áä∂ÊÄÅ-->
                <el-form-item v-if="isEdit" label="‰∏äÊû∂Áä∂ÊÄÅ">
                    <el-select v-model="editForm.shelfStatus" placeholder="ËØ∑ÈÄâÊã©" style="width: 240px">
                        <el-option v-for="item in options3" :key="item.value" :label="item.label" :value="item.value"/>
                    </el-select>
                </el-form-item>
                <!--                ÂÆ°ÊâπÁä∂ÊÄÅ-->
                <el-form-item v-if="isEdit" label="ÂÆ°ÊâπÁä∂ÊÄÅ">
                    <el-select v-model="editForm.approvalStatus" placeholder="ËØ∑ÈÄâÊã©" style="width: 240px">
                        <el-option v-for="item in options4" :key="item.value" :label="item.label" :value="item.value"/>
                    </el-select>
                </el-form-item>

            </el-form>

            <template #footer>
                <el-button type="primary" @click="onSubmit()">Êèê‰∫§</el-button>
                <el-button @click="showDialog = false">ÂèñÊ∂à</el-button>
            </template>

        </el-dialog>
    </el-row>
    </template>
<!--    ËØ¶ÁªÜË°®ÔºàspuÂ±ÇÈù¢Ôºâ-->
    <template v-else-if='isDetail'>
        <el-button text="plain" @click="isDetail = false"> < ËøîÂõû</el-button>
        <el-descriptions
                title="üìñÂïÜÂìÅËØ¶ÁªÜ"
                direction="vertical"
                border
                style="margin-top: 20px"
        >
            <el-descriptions-item
                    :rowspan="3"
                    :width="140"
                    label="Â§¥ÂÉè"
                    align="center"
            >
                <div>
                    <img v-if="detailForm.mainImage" :src="`/MFile/download?id=${detailForm.mainImage}`" style="width: 100px; height: 100px" />
                    <el-icon v-else><Plus /></el-icon>
                </div>
            </el-descriptions-item>
            <el-descriptions-item label="ÂïÜÂìÅÁºñÂè∑">{{detailForm.spuId}}</el-descriptions-item>
            <el-descriptions-item label="ÂïÜÂìÅÂêçÁß∞">{{detailForm.spuName}}</el-descriptions-item>
            <el-descriptions-item label="ÂïÜÂìÅËØ¶ÁªÜ">{{detailForm.spuDesc}}</el-descriptions-item>
            <el-descriptions-item label="ÊâÄÂ±ûÂïÜÊà∑">{{detailForm.merchantId}}</el-descriptions-item>
            <el-descriptions-item label="ÂïÜÂìÅÁ±ªÂûã">{{detailForm.productCategory}}</el-descriptions-item>
            <el-descriptions-item label="ÂÆ°ÊâπÁä∂ÊÄÅ">{{detailForm.approvalStatus}}</el-descriptions-item>
            <el-descriptions-item label="‰∏äÊû∂Áä∂ÊÄÅ">{{detailForm.shelfStatus}}</el-descriptions-item>
            <el-descriptions-item label="ÈîÄÈáè">{{detailForm.sales}}</el-descriptions-item>
            <el-descriptions-item label="ÂàõÂª∫Êó∂Èó¥">{{detailForm.createTime}}</el-descriptions-item>
        </el-descriptions>
    </template>
</div>
</body>
<script>

    const app =  Vue.createApp({
        data() {
            return {
                fileList: [],
                dialogImageUrl: '',
                dialogVisible: false,
                // Êü•ËØ¢ÁïåÈù¢
                form: {
                    spuId: '',
                    productCategory: '',
                    merchantId: '',
                    spuName: '',
                    createTime: '',
                    shelfStatus: '',
                    approvalStatus: ''
                },
                //ÂïÜÂìÅÂàÜÁ±ªÁöÑÈÄâÊã©Âô®
                options1: [
                    {
                        value: 'Êµ∑È≤ú',
                        label: 'Êµ∑È≤ú',
                    },
                    {
                        value: 'Á¢≥ÁÉ§È£üÂìÅ',
                        label: 'Á¢≥ÁÉ§È£üÂìÅ',
                    },
                    {
                        value: 'Ê∞¥Êûú',
                        label: 'Ê∞¥Êûú',
                    },
                ],
                //ÂïÜÊà∑ÂêçÂàÜÁ±ªÁöÑÈÄâÊã©Âô®
                options2: [
                    {
                        value: '1973386479124234242',
                        label: 'ÁÉßÁÉ§Â∫ó',
                    },
                    {
                        value: '1973385448478883842',
                        label: 'Ê∞¥‰∫ß‰∏ìÂçñÂ∫ó',
                    },
                    {
                        value: '1973386025069854721',
                        label: 'Ê∞¥ÊûúÂ∫ó',
                    },
                ],
                //‰∏äÊû∂Áä∂ÊÄÅÁöÑÈÄâÊã©Âô®
                options3: [
                    {
                        value: 'on',
                        label: '‰∏äÊû∂',
                    },
                    {
                        value: 'off',
                        label: '‰∏ãÊû∂',
                    },
                ],
                //ÂÆ°ÊâπÁä∂ÊÄÅÁöÑÈÄâÊã©Âô®
                options4: [
                    {
                        value: 'pending',
                        label: 'ÂæÖÂÆ°Ê†∏',
                    },
                    {
                        value: 'approved',
                        label: 'Â∑≤ÂÆ°Ê†∏',
                    },
                    {
                        value: 'rejected',
                        label: 'Â∑≤ÊãíÁªù',
                    },
                ],
                // Ë°®Ê†º
                gridOptions: {
                    border: true,
                    height: 400,
                    data: [],
                    headerAlign: 'center',
                    align: 'center',
                    columns: [
                        {type: 'seq', width: 60},
                        {field: 'spuId', title: 'ÂïÜÂìÅÁºñÂè∑'},
                        {field: 'spuName', title: 'ÂïÜÂìÅÂêçÁß∞'},
                        {field: 'merchantId', title: 'ÊâÄÂ±ûÂïÜÊà∑'},
                        {field: 'shelfStatus', title: '‰∏äÊû∂Áä∂ÊÄÅ'},
                        {field: 'productCategory', title: 'ÂïÜÂìÅÂàÜÁ±ª'},
                        {field: 'createTime', title: 'ÂàõÂª∫Êó∂Èó¥'},
                        {field: 'totalStock', title: 'SPUÂ∫ìÂ≠ò'},
                        {field: 'sales', title: 'ÈîÄÈáè'},
                        {field: 'approvalStatus', title: 'ÂÆ°ÊâπÁä∂ÊÄÅ'},
                        {title: 'Êìç‰Ωú', slots: {default: 'operate'}, width: 220}
                    ],
                    toolbarConfig: {
                        custom: true,
                        slots: {buttons: 'toolbar_buttons'}
                    },
                },
                page: {
                    current: 1,
                    size: 20,
                    total: 0
                },
                //ÁºñËæë
                showDialog: false,
                //Êñ∞Â¢û
                isEdit: false,
                //ÁºñËæëÂíåÊñ∞Â¢ûÁöÑÁïåÈù¢
                editForm: {
                    //spuË°®
                    spuId: '',
                    spuName: '',
                    spuDesc: '',
                    productCategory: '',
                    sales: '',
                    image: [],
                    merchantId: '',
                    mainImage: '',
                    shelfStatus: '',
                    approvalStatus: '',
                },
                // ËØ¶ÁªÜÂÜÖÂÆπ
                isDetail: false,
                detailForm: {
                    mainImage: '',
                    spuId: '',
                    spuName: '',
                    spuDesc: '',
                    productCategory: '',
                    merchantId: '',
                    approvalStatus: '',
                    shelfStatus: '',
                    sales: '',
                    createTime: '',
                },
                rules: {
                },
            };
        },
        async created() {
            await this.getList();
        },
        methods: {
            async Submit(fileList) {
                console.log(fileList);
                debugger;
                const data = new FormData();
                fileList.forEach(file => {
                    data.append('files', file.raw);
                });
                 const response = await axios.post('/MFile/uploadList', data, {
                     headers: {
                         'Content-Type': 'multipart/form-data'
                     }
                 });
                 console.log(response);
            },
            //Êü•ËØ¢
            async getList() {
                const form= this.form;
                const response= await axios.post('/MGoods/getList', { spuId: form.spuId, productCategory: form.productCategory, merchantId: form.merchantId, spuName: form.spuName, createTime: form.createTime, shelfStatus: form.shelfStatus, approvalStatus: form.approvalStatus, current: this.page.current, size: this.page.size});
                this.gridOptions.data= response.data.records;
                this.page.current= response.data.current;
                this.page.size= response.data.size;
                this.page.total= response.data.total;
                console.log(this.gridOptions.data);
            },
            //Êç¢È°µÁöÑÊõ¥Êñ∞
            onPageChange() {
                this.getList();
            },
            //ÁºñËæëÊåâÈíÆ
            edit(product) {
                this.showDialog= true;
                this.isEdit= true;
                this.editForm= {...product};
            },
            //Êñ∞Â¢ûÊåâÈíÆ
            add() {
                this.showDialog= true;
                this.isEdit= false;
                this.editForm= {};
            },
            //Êü•ËØ¢ÊåâÈíÆ
            onSearch() {
                this.getList();
            },
            //ÈáçÁΩÆÊåâÈíÆ
            onDelete() {
                this.form.spuId = '';
                this.form.productCategory = '';
                this.form.merchantId = '';
                this.form.spuName = '';
                this.form.createTime = '';
                this.form.shelfStatus = '';
                this.form.approvalStatus = '';
            },
            //ÁßªÈô§ÂäüËÉΩ
            async onRemove(spuId) {
                await axios.post('/MGoods/remove', {spuId});
                await this.getList();
            },
            async uploadMainImage(f) {
                try {
                    const response = await axios.post('/MFile/upload', { file: f}, {
                        headers: { 'Content-Type': 'multipart/form-data' }
                    });
                    this.editForm.mainImage = response.data.id;
                    return false;
                } catch (error) {
                    console.error('‰∏ä‰º†Â§±Ë¥•', error);
                    // Ê∑ªÂä†ÈîôËØØÊèêÁ§∫
                }
            },
            onSubmit() {
                this.$refs.editForm.validate(async valid =>{
                        if(valid) {
                            await axios.post(this.isEdit? '/merchant/edit': '/merchant/add', this.editForm);
                            await this.getList();
                            this.showDialog= false;
                        }
                    }
                );
            },

            showDetailDialog(product) {
                this.isDetail = true;
                this.detailForm.spuId = product.spuId;
                this.detailForm.spuName = product.spuName;
                this.detailForm.spuDesc = product.spuDesc;
                this.detailForm.mainImage = product.mainImage;
                this.detailForm.productCategory = product.productCategory;
                this.detailForm.merchantId = product.merchantId;
                this.detailForm.createTime = product.createTime;
                this.detailForm.approvalStatus = product.approvalStatus;
                this.detailForm.shelfStatus = product.shelfStatus;
                this.detailForm.sales = product.sales;
                this.detailForm.createTime = product.createTime;
            },
        }
    });
    for(const[key, component] of Object.entries(ElementPlusIconsVue)) {app.component(key, component)}
    app.use(ElementPlus).use(VxeUITable).mount('#app');
</script>
</html>